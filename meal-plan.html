<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Plan</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
        body{font-family: "Poppins", sans-serif !important;}
        .recipe-card {
            background: #fefefe;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .recipe-title {
            background: linear-gradient(180deg, #99b2f4, #8b91e9, #6e4bd0);
            color: #ffffff;
            padding: 10px;
            border-radius: 8px 8px 0 0;
            text-align: center;
        }
        .ingredient-list, .preparation {
            margin: 20px 0;
        }
        .notes, .nutrition {
            font-size: 0.9em;
            margin-top: 20px;
        }
        .nutrition table {
            width: 100%;
        }
        .full-width-image {
            width: 100%;
            height: auto;
        }
        h4{
            color: #8074df;
        }
        /* body {
        margin: 0;
        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        font-family: sans-serif;
        } */

        h1,
        p {
        margin: 0;
        padding: 0;
        line-height: 1.5;
        }

        .app {
        width: 90%;
        max-width: 500px;
        margin: 0 auto;
        }
        .container {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        }

        .item {
        width: 90px;
        height: 90px;
        display: flex;
        justify-content: center;
        align-items: center;
        user-select: none;
        }
        .radio {
        display: none;
        }
        .radio ~ span {
        font-size: 3rem;
        filter: grayscale(100);
        cursor: pointer;
        transition: 0.3s;
        }

        .radio:checked ~ span {
        filter: grayscale(0);
        font-size: 4rem;
        }
        .back-link {
            /* font-family: "Gilroy", Sans-serif; */
            font-size: 16px;
            font-weight: 600;
            text-transform: none;
            line-height: 1em;
            letter-spacing: 0px;
            width: 50%;
            /* background: linear-gradient(180deg, #99b2f4, #8b91e9, #6e4bd0);
            */
            background: linear-gradient(180deg, #99b2f4, #8b91e9, #6e4bd0);
            color: white;
            border-style: solid;
            border-width: .9px;
            border-color: white;
            border-radius: 30px !important;
            box-shadow: 0px 0px 6px 1px #7a57db;
        }
        .navbar-light{
            background-color: #8984e4 !important;
            height: 90px;
        }
        .meal-type{
            color: #8984e4;
            background: aliceblue;
            padding: 10px;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="#"><img width="60" height="60" src="https://fabulous50s.com/wp-content/uploads/2023/08/logo-2.svg" class="attachment-full size-full wp-image-36441" alt></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
            </ul>
        </div>
    </div>
</nav>
<div class="container mt-5">
    <div id="meal-container" class="recipe-card">
        <!-- Dynamic meal plan content will be inserted here -->
    </div>
</div>

<!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var urlParams = new URLSearchParams(window.location.search);
        var mealPlanData = JSON.parse(decodeURIComponent(urlParams.get('mealPlanData')));

        console.log('Loaded Meal Plan Data:', mealPlanData); // Debugging statement

        var mealTypes = ["breakfast", "snack1", "lunch", "snack2", "dinner"];
        var mealContainer = document.getElementById("meal-container");

        mealTypes.forEach(mealType => {
            var meal = mealPlanData[mealType];
            if (meal) {
                var formattedData = `
                    <div class="meal-type">
                        <h2>${mealTypes[mealType]}</h2>
                    </div>
                    <div class="recipe-title">
                        <h2>${meal.recipe_name}</h2>
                        <p>${meal.serving} Servings, ${meal.cooking_time}</p>
                    </div>
                    <img src="${meal.image_url}" class="mealimage full-width-image" alt="Meal Image">
                    <div class="row">
                        <div class="col-md-6 ingredient-list">
                            <h4>Ingredient List</h4>
                            <ul>
                                ${meal.shopping_list.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="col-md-6 preparation">
                            <h4>Preparation</h4>
                            <ol>
                                ${meal.preparation_step.map(step => `<li>${step}</li>`).join('')}
                            </ol>
                        </div>
                    </div>
                    <div class="nutrition">
                        <h4>Nutrition Information (Amount Per Serve)</h4>
                        <table class="table table-bordered">
                            ${meal.nutrition.map(item => `<tr><td>${item}</td></tr>`).join('')}
                        </table>
                    </div>
                    <hr>
                `;
                mealContainer.innerHTML += formattedData;
            }
        });

        // Add event listeners to emoji buttons
        var feedbackRadios = document.querySelectorAll('.radio');
        feedbackRadios.forEach(function(radio) {
            radio.addEventListener('change', function() {
                var review = this.value;
                saveMealDataToAirtable(recipeName, cookingTime, serving, shoppingList, preparationSteps, nutrition, imageUrl, review);
            });
        });
    });

    function saveMealDataToAirtable(recipeName, cookingTime, serving, shoppingList, preparationSteps, nutrition, imageUrl, review) {
        var data = {
            'fields': {
                'user_name': 'meal_app',
                'meal_type': mealType,
                'recipe_name': recipeName,
                'cooking_time': cookingTime,
                'serving': serving,
                'shopping_list': shoppingList.join(', '),
                'preparation_step': preparationSteps.join(', '),
                'nutrition': nutrition.join(', '),
                'image': imageUrl,
                'reviews': review
            }
        };

        fetch('https://api.airtable.com/v0/appAGxrSU8fcqg5kJ/tblyILjVSp2dVovCx', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer YOUR_API_KEY',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(`Error: ${data.error.message}`);
            } else {
                alert('Your review has been saved. Thank you!');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('There was an error saving your review. Please try again.');
        });
    }
</script> -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        var urlParams = new URLSearchParams(window.location.search);
        var mealPlanData = JSON.parse(decodeURIComponent(urlParams.get('mealPlanData')));

        console.log('Loaded Meal Plan Data:', mealPlanData); // Debugging statement

        var mealTypes = {
            breakfast: "Breakfast",
            snack1: "Snack 1",
            lunch: "Lunch",
            snack2: "Snack 2",
            dinner: "Dinner"
        };

        var mealContainer = document.getElementById("meal-container");

        Object.keys(mealTypes).forEach(mealType => {
            var meal = mealPlanData[mealType];
            if (meal) {
                var formattedData = `
                    <div class="meal-type">
                        <center><h2>${mealTypes[mealType]}</h2></center>
                    </div>
                    <div class="recipe-title">
                        <h2>${meal.recipe_name}</h2>
                        <p>${meal.serving} Servings, ${meal.cooking_time}</p>
                    </div>
                    <img src="${meal.image_url}" class="mealimage full-width-image" alt="Meal Image">
                    <div class="row">
                        <div class="col-md-6 ingredient-list">
                            <h4>Ingredient List</h4>
                            <ul>
                                ${meal.shopping_list.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="col-md-6 preparation">
                            <h4>Preparation</h4>
                            <ol>
                                ${meal.preparation_step.map(step => `<li>${step}</li>`).join('')}
                            </ol>
                        </div>
                    </div>
                    <div class="nutrition">
                        <h4>Nutrition Information (Amount Per Serve)</h4>
                        <table class="table table-bordered">
                            ${meal.nutrition.map(item => `<tr><td>${item}</td></tr>`).join('')}
                        </table>
                    </div>
                    <hr>
                    <div class="app">
                        <center><h4>Was this meal useful?</h4></center>
                        <div class="container">
                            <div class="item">
                                <label for="0">
                                    <input class="radio" type="radio" name="feedback" id="0" value="🤬">
                                    <span>🤬</span>
                                </label>
                            </div>
                            <div class="item">
                                <label for="1">
                                    <input class="radio" type="radio" name="feedback" id="1" value="🙁">
                                    <span>🙁</span>
                                </label>
                            </div>
                            <div class="item">
                                <label for="2">
                                    <input class="radio" type="radio" name="feedback" id="2" value="😶">
                                    <span>😶</span>
                                </label>
                            </div>
                            <div class="item">
                                <label for="3">
                                    <input class="radio" type="radio" name="feedback" id="3" value="😁">
                                    <span>😁</span>
                                </label>
                            </div>
                            <div class="item">
                                <label for="4">
                                    <input class="radio" type="radio" name="feedback" id="4" value="😍">
                                    <span>😍</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <center><a href="index.html" class="btn btn-primary back-link">Go Back to Main Page</a></center>
                `;
                mealContainer.innerHTML += formattedData;
            }
        });

        // Add event listeners to emoji buttons
        var feedbackRadios = document.querySelectorAll('.radio');
        feedbackRadios.forEach(function(radio) {
            radio.addEventListener('change', function() {
                var review = this.value;
                saveMealDataToAirtable(recipeName, cookingTime, serving, shoppingList, preparationSteps, nutrition, imageUrl, review);
            });
        });
    });

    function saveMealDataToAirtable(recipeName, cookingTime, serving, shoppingList, preparationSteps, nutrition, imageUrl, review) {
        var data = {
            'fields': {
                'user_name': 'meal_app',
                'meal_type': mealType,
                'recipe_name': recipeName,
                'cooking_time': cookingTime,
                'serving': serving,
                'shopping_list': shoppingList.join(', '),
                'preparation_step': preparationSteps.join(', '),
                'nutrition': nutrition.join(', '),
                'image': imageUrl,
                'reviews': review
            }
        };

        fetch('https://api.airtable.com/v0/appAGxrSU8fcqg5kJ/tblyILjVSp2dVovCx', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer YOUR_API_KEY',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert(`Error: ${data.error.message}`);
            } else {
                alert('Your review has been saved. Thank you!');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('There was an error saving your review. Please try again.');
        });
    }
</script>
</body>
</html>